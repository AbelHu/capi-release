#!/usr/bin/env bash

echo "MEOW HI TIM"

#for cloud_controller_ng and cloud_controller_api_worker
TMPDIR=/var/vcap/data/cloud_controller_ng/tmp
RUN_DIR=/var/vcap/sys/run/cloud_controller_ng
LOG_DIR=/var/vcap/sys/log/cloud_controller_ng
echo "set vars"

mkdir -p $RUN_DIR
mkdir -p $LOG_DIR
mkdir -p $TMPDIR
echo "made directories"

chown vcap:vcap $RUN_DIR
chown -R vcap:vcap $LOG_DIR
chown vcap:vcap $TMPDIR
echo $?


<% if_p("cc.directories.diagnostics") do |diag_dir| %>
mkdir -p <%= diag_dir %>
chown vcap:vcap <%= diag_dir %>
<% end %>

mkdir -p /var/vcap/sys/cores
chown vcap:vcap /var/vcap/sys/cores

#for cloud_controller_migrations
RUN_DIR=/var/vcap/sys/run/cloud_controller_migration
LOG_DIR=/var/vcap/sys/log/cloud_controller_migration

mkdir -p $RUN_DIR
mkdir -p $LOG_DIR

chown vcap:vcap $RUN_DIR
chown vcap:vcap $LOG_DIR

<%
  [
   '/var/vcap/sys/log/cloud_controller_migration/cloud_controller_migration_ctl.err.log',
   '/var/vcap/sys/log/cloud_controller_migration/cloud_controller_migration_ctl.log',
   '/var/vcap/sys/log/cloud_controller_migration/cloud_controller_migration_ctl.log',
   '/var/vcap/sys/log/cloud_controller_ng/cloud_controller_ng_ctl.err.log',
   '/var/vcap/sys/log/cloud_controller_ng/cloud_controller_ng_ctl.log',
   '/var/vcap/sys/log/cloud_controller_ng/cloud_controller_worker_ctl.err.log',
   '/var/vcap/sys/log/cloud_controller_ng/cloud_controller_worker_ctl.log'
  ].each do |path|
  %>
  if [ -f <%= path %> ]; then
    exec "/usr/bin/env bash -c 'chown vcap:vcap <%= path %>'"
  fi
<% end %>

whoami


exit 0
